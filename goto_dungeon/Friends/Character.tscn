[gd_scene load_steps=5 format=2]

[ext_resource path="res://CharacterScenes/NakedGuy.tscn" type="PackedScene" id=1]
[ext_resource path="res://Sprites/arrows.png" type="Texture" id=2]

[sub_resource type="GDScript" id=1]
script/source = "extends KinematicBody2D

export var player = \"p1\"
export var speed = 60
export var character_type = CharacterType.NAKED

func _ready():
	var color = get_color();
	self.get_node(\"Highlighter\").modulate = color;

func _physics_process(delta):
	var move_vec = get_move_vec_for_player(player)
	move_and_slide(move_vec * speed)
	flip_sprite(move_vec)
	choose_animation(move_vec)

func get_color():
	var color = Color(0, 1, 0, 1); # lime default
	if (self.name == 'Character'):
		color = Color(1, 1, 0, 1); # yellow
	elif (self.name == 'Character2'):
		color = Color( 0, 1, 1, 1 ); # aqua
	elif (self.name == 'Character3'):
		color = Color( 1, 0, 0, 1 ); # red
	return color;

func change_character(node: Node2D, type):
	var t = $NakedGuy.transform
	remove_child($NakedGuy)
	
	node.name = \"NakedGuy\"
	node.transform = t
	add_child(node)
	
	character_type = type

func choose_animation(vec: Vector2):
	if vec.x == 0 and vec.y == 0:
		$NakedGuy/AnimationPlayer.play(\"Idle\")
	else:
		$NakedGuy/AnimationPlayer.play(\"Walk\")

func flip_sprite(vec: Vector2):
	if vec.x < 0:
		$NakedGuy/Sprite.flip_h = true
	if vec.x > 0:
		$NakedGuy/Sprite.flip_h = false

func get_move_vec_for_player(player):
	var move_vec = Vector2(0, 0)
	if Input.is_action_pressed(player + \"_up\"):
		move_vec += Vector2.UP
		self.get_node(\"Highlighter\").frame = 0
	if Input.is_action_pressed(player + \"_down\"):
		move_vec += Vector2.DOWN
		self.get_node(\"Highlighter\").frame = 1		
	if Input.is_action_pressed(player + \"_left\"):
		move_vec += Vector2.LEFT
		self.get_node(\"Highlighter\").frame = 2		
	if Input.is_action_pressed(player + \"_right\"):
		move_vec += Vector2.RIGHT
		self.get_node(\"Highlighter\").frame = 3		
	move_vec = move_vec.normalized()
	return move_vec
"

[sub_resource type="CapsuleShape2D" id=2]
radius = 7.0
height = 0.718109

[node name="Character" type="KinematicBody2D"]
script = SubResource( 1 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource( 2 )

[node name="NakedGuy" parent="." instance=ExtResource( 1 )]
position = Vector2( 0.530334, -8.66206 )

[node name="Highlighter" type="Sprite" parent="."]
position = Vector2( 0.971386, 9.20495 )
scale = Vector2( 0.206709, 0.0615164 )
texture = ExtResource( 2 )
hframes = 4
